

########################################################################################################################################################
########################################################################################################################################################
########################################################################################################################################################
########################################################################################################################################################
#### Example 6.5.1
observ <- c(102, 82, 16)
p.null <- c(0.45,0.4,0.15)
expected <- 200*p.null

chi.stat <- sum( (observ-expected)^2/expected )
p.value <- 1-pchisq( chi.stat, 2)


marketing <- chisq.test( observ, p=p.null)

########################################################################################################################################################
########################################################################################################################################################
########################################################################################################################################################
########################################################################################################################################################
#### Teenage suicide example
suicide <-  c(1867,1789,1944,2094,2097,1981,1887,2024,1928,2039,1978,1859)
days <- c(31,28,31,30,31,30,31,31,30,31,30,31)
p.null.suicide <- days/365

chisq.suicide <- chisq.test( suicide, p=p.null.suicide)



########################################################################################################################################################
########################################################################################################################################################
########################################################################################################################################################
########################################################################################################################################################
#### Example 6.5.3
## Exit poll
poll = read.table( "http://astro.temple.edu/~zhaozhg/Stat8003/data/ExitPoll1.txt", header=TRUE )
x= poll[1:2, 1:2 ]
poll.test <- chisq.test( x )

##
poll2 <- read.table( "http://astro.temple.edu/~zhaozhg/Stat8003/data/ExitPoll2.txt", header=TRUE )
x <- poll2[1:5, 1:2]
poll2.test <- chisq.test(x)


########################################################################################################################################################
########################################################################################################################################################
########################################################################################################################################################
########################################################################################################################################################
#### Example 6.6.1
## GPD 
gdp.all <- read.csv("http://astro.temple.edu/~zhaozhg/Stat8003/data/GDP_Per_Capita.csv")
gdp <- gdp.all[,62]
gdp[ is.na(gdp) ] <- NULL
n <- length(gdp)

par( mfrow=c(2,2) )
## Sort the data
gdp.sort <- sort(gdp, decreasing=FALSE )
## Normal
mu <- mean(gdp.sort)
sigma <- sqrt( var(gdp.sort) )
q.norm <- qnorm( (c(1:n)-0.5)/n, mu, sigma, lower.tail=TRUE )
plot( q.norm, gdp.sort, main="Normal" )
points(c( q.norm[1], q.norm[n]), c(q.norm[1], q.norm[n]), 'l',col='red', lwd=2)

## Log Normal
## Sort the data
l.gdp.sort <- sort(log(gdp), decreasing=FALSE )
## Normal
l.mu <- mean(l.gdp.sort)
l.sigma <- sqrt( var(l.gdp.sort) )
l.q.norm <- qnorm( (c(1:n)-0.5)/n, l.mu, l.sigma, lower.tail=TRUE )
plot( l.q.norm, l.gdp.sort, main="Log Normal")
points(c( l.q.norm[1], l.q.norm[n]), c(l.q.norm[1], l.q.norm[n]), 'l',col='red', lwd=2)


## Gamma model
alpha.mle <- 0.8131734
beta.mle <- 16575.21

gdp.sort <- sort(gdp, decreasing=FALSE )
## Normal
q.gamma <- qgamma( (c(1:n)-0.5)/n, alpha.mle, 1/beta.mle, lower.tail=TRUE )
plot( q.gamma, gdp.sort, main="Gamma" )
points(c( q.gamma[1], q.gamma[n]), c(q.gamma[1], q.gamma[n]), 'l',col='red', lwd=2)

qqnorm(gdp)
qqline(gdp,col='red', lwd=2)

########################################################################################################################################################
########################################################################################################################################################
########################################################################################################################################################
########################################################################################################################################################
#### Example 6.6.2
par(mfrow=c(2,2))
t.3 <- rt(1000, 3)
t.5 <- rt(1000, 5)
t.10 <- rt(1000, 10)
t.100 <- rt(1000, 100)

qqnorm(t.3)
qqline(t.3,col='red', lwd=2)


qqnorm(t.5)
qqline(t.5,col='red', lwd=2)


qqnorm(t.10)
qqline(t.10,col='red', lwd=2)


qqnorm(t.100)
qqline(t.100,col='red', lwd=2)


########################################################################################################################################################
########################################################################################################################################################
########################################################################################################################################################
########################################################################################################################################################
#### Example 6.7.1
## GDP KS test
gdp.all <- read.csv("http://astro.temple.edu/~zhaozhg/Stat8003/data/GDP_Per_Capita.csv")
gdp <- gdp.all[,62]
gdp[ is.na(gdp) ] <- NULL
n <- length(gdp)

gdp.sort <- sort( gdp, decreasing=FALSE) 

##Normal case
mu <- mean(gdp.sort)
sigma <- sqrt( var(gdp.sort) )
cdf.normal <- pnorm( gdp.sort, mu, sigma )
ks.normal <- max( abs( cdf.normal - c(0:(n-1))/n), abs( cdf.normal-c(1:n)/n) )

##Log-Normal case
l.gdp.sort <- log( gdp.sort )
l.mu <- mean(l.gdp.sort)
l.sigma <- sqrt( var(l.gdp.sort ) )
l.cdf.normal <- pnorm( l.gdp.sort, l.mu, l.sigma )
ks.l.normal <- max( abs( l.cdf.normal - c(0:(n-1))/n), abs( l.cdf.normal-c(1:n)/n) )


## Gamma model
alpha.mle <- 0.8131734
beta.mle <- 16575.21
cdf.gamma <- pgamma( gdp.sort, alpha.mle, 1/beta.mle )
ks.gamma <- max( abs( cdf.gamma - c(0:(n-1))/n), abs( cdf.gamma-c(1:n)/n) )

cat( paste("p-value for Normal:", 1-pkolm( ks.normal,n ) ), "\n", paste("p-value for Log-Normal:", 1-pkolm( ks.l.normal,n )), "\n", paste("p-value for gamma:", 1-pkolm( ks.gamma,n )), "\n" )


ks.test( l.gdp.sort, 'pnorm' )
ks.test( (l.gdp.sort-l.mu)/l.sigma, 'pnorm' )


########################################################################################################################################################
########################################################################################################################################################
########################################################################################################################################################
########################################################################################################################################################
#### Example 6.7.2
X <- read.table("http://astro.temple.edu/~zhaozhg/Stat8003/data/prostate_X.csv",sep=",")
Y <- read.table("http://astro.temple.edu/~zhaozhg/Stat8003/data/prostate_Y.csv",sep=",")

## Consider gene 1720
X1720.control <- X[1720,][Y==1] 
X1720.treat <- X[1720,][Y==2]

## Consider gene 1
X1.control <- X[1,][Y==1] 
X1.treat <- X[1,][Y==2]



########################################################################################################################################################
########################################################################################################################################################
########################################################################################################################################################
########################################################################################################################################################
#### Example 6.8.1

num.perm <- 10000

## Gene 1720
X1720 <- as.numeric( X[1720,] )
Ttest <- t.test(X1720~Y$x)$statistic
n <- length(Y$x)

perm.stat <- rep(0, num.perm)
for(i in 1:num.perm)
  {
    group <- Y$x[ sample( c(1:n), n, replace=FALSE) ]
    perm.stat[i] <- t.test(X1720~group)$statistic
  }
p.value.perm1720 <- sum( abs(perm.stat)>abs(Ttest) )/num.perm

### Gene 1
X1 <- as.numeric( X[1,] )
Ttest <- t.test(X1~Y$x)$statistic
n <- length(Y$x)

perm.stat <- rep(0, num.perm)
for(i in 1:num.perm)
  {
    group <- Y$x[ sample( c(1:n), n, replace=FALSE) ]
    perm.stat[i] <- t.test(X1~group)$statistic
  }
p.value.perm1 <- sum( abs(perm.stat)>abs(Ttest) )/num.perm


